# python scapy库


## 基础知识
####  ARP帧结构
![arp_packet_struct.png](./imgs/arp_packet_struct.png)
>以太网头部  
>>以太网目的地址： 6字节（48位）的目的地MAC地址数值  
>>以太网源地址：6字节报文发送者的MAC地址数值  
>>帧类型：表示后面的是什么数据。ARP报文为0x806  
>  
>ARP报文
>>硬件类型：表示硬件地址的类型，ARP报文中使用1，代表MAC地址  
>>协议类型：表示要映射的协议地址类型。0x0800即表示IP地址。  
>>硬件地址长度：地址长度，单位为字节。硬件地址长度为6字节  
>>协议地址长度：地址长度，单位为字节。IP地址长度为4字节  
>>op(opration code)：操作码。1表示ARP请求报文，2表示ARP回应报文。RARP的请求和回应分别为3和4  
>>发送端以太网地址：发送者的以太网地址  
>>发送端IP地址：发送者的IP地址  
>>目的以太网地址：当报文为ARP请求报文时，此处不填。当报文为ARP回应报文时，此处填为目的IP地址对应的MAC地址  
>>目的IP地址：欲查询的MAC地址对应的IP地址  

#### scapy库  
使用scapy库可以构造基于OSI参考模型的数据包，常用的Layer有 Ether、IP、UDP、TCP、UDP。这些协议的包如果不手动指定其中field的数值，scapy会自动根据环境进行指定。  
构造发送的包的时候，可以指定不只一个layer的包的数值。可以将多个layer的包的数值进行叠加:  
>

## scapy库的使用  
#### 查询IP地址对应的MAC地址
```python
>> res = sr1(ARP(pdst="10.10.10.10"))
>> res.hwsrc
'ea:bb:cc:ee:1d:db'
```

