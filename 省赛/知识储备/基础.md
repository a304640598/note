# PHP函数及禁用


## 命令执行类

名称 | 参数 | 备注 |
 :- | :- | :-
exec | (string cmd) | 执行系统命令，返回string类型执行结果
system | (string cmd) |  执行系统命令，返回string类型执行结果
passthu | (string cmd) | 执行系统命令，返回string类型执行结果
shell_exec | (string cmd) | 执行系统命令，返回string类型执行结果
eval | (string cmd) | 执行PHP命令，返回执行结果。菜刀连接需要使用eval函数构造一句话木马  （无法直接禁用）
assert | (string cmd)| 执行函数并检测其返回值，为true则函数返回为true，否则为false



#### 函数利用
**eval()**
一个php语句注入的例子  
`payload:  http://leafev.com/?data=fuckyou");phpinfo();//`  

```php
<?php
#将传入的字符串进行小写化，然后echo结果，存在类似于sql注入的语句注入漏洞
$data = $_GET['data'];
eval("\$ret = strtolower(\"$data\");");//此处可以通过精心构造$data,截断eval原执行的语句，插入恶意代码
echo $ret;
?>
```

**assert()**
在ubuntu用apt命令安装的php7中，默认禁止编译assert的代码，只会进行语法分析，配置项：  
```conf
#/etc/php/7.2/apache2/php.ini
[Assertion]
; -1: Do not compile at all
;  0: Jump over assertion at run-time
;  1: Execute assertions
; Changing from or to a negative value is only possible in php.ini! (For turning assertions on and off at run-time, see assert.active, when zend.assertions = 1)
; 当数值为-1改到其他数值的时候，或者想从其他数值改到-1的时候，必须要改文件
; 其他时候可以通过执行assert_options(ASSERT_ACTIVE, 数值);在运行的时候设置该值
; Default Value: 1
; Development Value: 1
; Production Value: -1
zend.assertions = -1
```
assert_options函数可以设置assert执行时的属性，其中一个属性可以指定assert失败的时候执行的call_back函数。
一个例子：
这里利用了extact函数的变量赋值
`payload: http://leafev.com/?func_name=boom&code=system()`
```php
<?php
    function boom()
    {
        system("cat flag.txt");
    }

    function warn()
    {
        echo "oh no!";
    }

   
    $func_name =  'warn';

    #if someone really writes this like a idiot...
    extract($_GET);

    assert_options(ASSERT_CALLBACK, $func_name);

    #no cat exceution
    $code = str_replace($code,"c","");
    echo assert($code);

?>
```
___
## 文件包含

___
## 函数禁用
通过配置disable_function来禁止某些函数的使用，eval无法通过此方式禁止，因为不是函数，需要使用php扩展suhosin
```conf
#/etc/php/7.2/apache2/php.ini
; This directive allows you to disable certain functions for security reasons.
; It receives a comma-delimited list of function names.
; http://php.net/disable-functions
disable_functions = pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,

```
禁用可能会误伤站点上用到这些函数的功能
___